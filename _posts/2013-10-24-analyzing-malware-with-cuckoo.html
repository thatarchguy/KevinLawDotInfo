---
layout: post
title: Analyzing Malware with Cuckoo
date: '2013-10-24T15:23:00.000-07:00'
author: Kevin L
tags: 
modified_time: '2013-10-24T16:08:30.984-07:00'
thumbnail: /images/post_cuckoo/thumb_cuckoo.png
blogger_id: tag:blogger.com,1999:blog-5768106710687360482.post-4634213792437982439
blogger_orig_url: http://blog.kevinlaw.info/2013/10/analyzing-malware-with-cuckoo.html
---

Converted from Blogger. Please excuse any layout errors!
<div class="separator" style="clear: both; text-align: center;">
    <a href="/images/post_cuckoo/cuckoo.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="/images/post_cuckoo/cuckoo.png" />
    </a>
</div><a href="http://cuckoosandbox.org/" target="_blank">Cuckoo Sandbox</a> is an automated malware analysis tool. It can tear apart a sample of malware and collect actionable threat data. Cuckoo is written in python, and is a free and open source tool.
<br />
<br />From their <a href="http://www.cuckoosandbox.org/about.html" target="_blank">About page</a>:
<br />
<blockquote class="tr_bq">
    <div style="background-color: white; color: #333333; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 13px; line-height: 18px; margin-bottom: 9px;">In three words, Cuckoo Sandbox is a malware analysis system.</div>
    <div style="background-color: white; color: #333333; font-family: 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif; font-size: 13px; line-height: 18px; margin-bottom: 9px;">What does that mean? It simply means that you can throw any suspicious file at it and in a matter of seconds Cuckoo will provide you back some detailed results outlining what such file did when executed inside an isolated environment.</div>
</blockquote>I am using Xubuntu 13.10 as the host machine for the lab. It is running inside of a Virtual machine for portability. Cuckoo is running version 0.6.
<br />
<br />Inside of the Xubuntu install, I have a Windows XP SP3 and a Windows 7 virtual machine on a VirtualBox install. Both of these machines have usual user applications, like Firefox, Adobe Reader, Java, etc...
<br />
<br />In order to use a virtual machine with Cuckoo, snapshots of the machine must be made for Cuckoo to start and revert back to. Upon uploading a sample, Cuckoo will restore the machine, execute and analyze the sample, and then revert the machine back to the snapshot.
<br />
<br />Here is an overview of the steps to use Cuckoo
<br />
<br />
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: right; margin-left: 1em; text-align: right;">
    <tbody>
        <tr>
            <td style="text-align: center;">
                <a href="/images/post_cuckoo/xubuntu-2013-10-24-16-37-26.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="225" src="/images/post_cuckoo/xubuntu-2013-10-24-16-37-26.png" width="400" />
                </a>
            </td>
        </tr>
        <tr>
            <td class="tr-caption" style="text-align: center;">
                <br />
            </td>
        </tr>
    </tbody>
</table>
<br />
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: right; margin-left: 1em; text-align: right;">
    <tbody>
        <tr>
            <td style="text-align: center;">
                <a href="/images/post_cuckoo/xubuntu-2013-10-24-16-37-58.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="225" src="/images/post_cuckoo/xubuntu-2013-10-24-16-37-58.png" width="400" />
                </a>
            </td>
        </tr>
        <tr>
            <td class="tr-caption" style="text-align: center;">The WebUI works very well.&nbsp;</td>
        </tr>
    </tbody>
</table>
<div style="text-align: center;">
    <br />
    <br />
    <br />
    <br />I went searching for Youtube Downloaders for malware samples. Aimbots and Cracks are good keywords to look for as well.&nbsp;</div>
<div style="text-align: center;">
    <br />
</div>
<div style="text-align: center;">
    <br />
</div>
<div style="text-align: center;">
    <br />
</div>
<div style="text-align: center;">
    <br />
</div>
<div style="text-align: center;">
    <br />
</div>
<div style="text-align: center;">
    <br />
</div>
<div style="text-align: center;">
    <br />
</div>
<div style="text-align: center;">
    <br />
</div>
<div style="text-align: center;">There is a WebUI for uploading samples that works very well.&nbsp;<span style="text-align: center;">There are many&nbsp;</span><a href="http://docs.cuckoosandbox.org/en/latest/usage/packages/" style="text-align: center;" target="_blank">different package</a>&nbsp;types that can be analyzed, like .jar, .pdf, and .zip's. Cuckoo does an excellent job and executing samples.</div>
<div class="separator" style="clear: both; text-align: center;">
    <a href="/images/post_cuckoo/xubuntu-2013-10-24-16-41-07.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="225" src="/images/post_cuckoo/xubuntu-2013-10-24-16-41-07.png" width="400" />
    </a>
</div>
<br />
<br />After analysis is complete (usually 10-120 seconds), you get a nice printout of what cuckoo found. It also stores all this information on the host, so you can download all the pcap's and logs to have analyzed with another tool, like Wireshark.
<br />
<div class="separator" style="clear: both; text-align: center;">
    <a href="/images/post_cuckoo/xubuntu-2013-10-24-16-41-24.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="225" src="/images/post_cuckoo/xubuntu-2013-10-24-16-41-24.png" width="400" />
    </a>
</div>
<br />
<br />
<br />
<br />
<br />Cuckoo takes screenshots everytime something changes on the screen. It will do it's best to automate installers too.
<br />
<div style="text-align: right;"></div>&nbsp;Because Cuckoo analyzes the traffic, it prints out what IP's and DNS addresses it attempts to connect to. This is invaluable information when trying to reverse and track malware.
<br />
<table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: right; margin-left: 1em; text-align: right;">
    <tbody>
        <tr>
            <td style="text-align: center;">
                <a href="/images/post_cuckoo/xubuntu-2013-10-24-16-41-34.png" imageanchor="1" style="clear: right; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" height="225" src="/images/post_cuckoo/xubuntu-2013-10-24-16-41-34.png" width="400" />
                </a>
            </td>
        </tr>
        <tr>
            <td class="tr-caption" style="text-align: center;">
                <br />
            </td>
        </tr>
    </tbody>
</table>
<div class="separator" style="clear: both; text-align: center;">
    <a href="/images/post_cuckoo/xubuntu-2013-10-24-16-53-59.png" imageanchor="1" style="clear: right; float: right; margin-bottom: 1em; margin-left: 1em;"><img border="0" height="225" src="/images/post_cuckoo/xubuntu-2013-10-24-16-53-59.png" width="400" />
    </a>
</div>
<br />
<br />
<br />
<br />&nbsp;This particular sample was not in the Virus Total database, so I uploaded it to have it analyzed by virus scanners for malicious intent. This sample was DownloadAdmin, an adware/PUA dropper.
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />
<br />It is common for malware to reach out to it's command and control domain once installed. They may also connect out and download more payloads. Cuckoo can capture those connections.
<br />
<br />
<table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;">
    <tbody>
        <tr>
            <td style="text-align: center;">
                <a href="/images/post_cuckoo/Capture.PNG" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" height="113" src="/images/post_cuckoo/Capture.PNG" width="640" />
                </a>
            </td>
        </tr>
        <tr>
            <td class="tr-caption" style="text-align: center;">Cuckoo will tell you if the malware is aware of virtualization.</td>
        </tr>
    </tbody>
</table>
<br />
<br />Cuckoo Sandbox makes automating malware analysis trivial. In my opinion, Cuckoo is a great starting point for analyzing a sample. It gives a wide range of useful information and displays it in an easy to read format. Some malware can detect if it has been run inside of a virtual machine, which is where Cuckoo falls short. Since Cuckoo is dependant on virtualization, you will only get a readout of hashes and a warning if the malware has a virtualization detection feature. Using a physical machine would be necessary for further analysis at that point.
<br />
<br />